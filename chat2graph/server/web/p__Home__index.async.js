"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[371],{74661:function(js,Me,o){o.r(Me),o.d(Me,{default:function(){return os}});var on=o(19632),ln=o.n(on),rn=o(64599),dn=o.n(rn),un=o(97857),A=o.n(un),cn=o(15009),xe=o.n(cn),vn=o(99289),Be=o.n(vn),mn=o(5574),X=o.n(mn),I={wrapper:"wrapper___bQpM3",sider:"sider___nWtOr","create-conversation":"create-conversation___NyCyB","go-manager":"go-manager___B71Oh","sider-collapsed":"sider-collapsed___VmpDc","sider-collapsed-icon":"sider-collapsed-icon___uWzBa","title-text":"title-text___f4Ncy",conversations:"conversations___p9ji9",tips:"tips___zVlSe","title-logo":"title-logo___P5Uad","conversation-extra-icon":"conversation-extra-icon___jAUWN",title:"title___YqZnO",chat:"chat___l9xZo",messages:"messages___SpG3r","has-tip":"has-tip___wu5jR",welcome:"welcome___W3CcU",footer:"footer___yPcMR",framework:"framework___pFwWi","chat-emty":"chat-emty___g1Z6B","user-conversation-question":"user-conversation-question___bX2Dq","user-conversation":"user-conversation___NrTNt"},ye=o(86250),Le=o(42075),V=o(83062),gn=o(86738),hn=o(64920),oe=o(85804),ie=o(57381),fn=o(38925),pn=o(86548),xn=o(48689),yn=o(90814),jn=o(6171),bn=o(24969),Sn=o(82968),Cn=o(93461),In=o(34114),Oe=o(82655),Nn=o(32330),Zn=o(9541),Ae=o(90442),je=o(71394),Rn=o(25278),kn=o(63606),Tn=o(97937),w=o(67294),Ue={"icon-check":"icon-check___j16ac","icon-cancel":"icon-cancel___xiNlG"},e=o(85893),En=function(v){var a=v.name,g=v.onConfirm,c=v.onEdited,S=(0,je.x)(a),u=X()(S,2),j=u[0],T=u[1];return(0,e.jsx)(Rn.Z,{onClick:function(i){i.stopPropagation()},value:j,suffix:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(oe.ZP,{type:"text",size:"small",icon:(0,e.jsx)(kn.Z,{}),className:Ue["icon-check"],onClick:function(){g==null||g(j),c==null||c()}}),(0,e.jsx)(oe.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Tn.Z,{}),className:Ue["icon-cancel"],onClick:function(){g==null||g(a),c==null||c()}})]}),onPressEnter:function(i){g==null||g(j),c==null||c()},onChange:function(i){var O;T(i==null||(O=i.target)===null||O===void 0?void 0:O.value)}})},Gn=En,y=o(67937),ve=o(56320),Dn=o(78205),Fn=o(78919),le=o(66949),Pn={placeholder:"placeholder___GPZGS","ant-welcome":"ant-welcome___zKaQH"},Mn=function(v){var a=v.placeholderPromptsItems,g=v.onPromptsItemClick,c=(0,ve.Z)(),S=c.formatMessage;return(0,e.jsxs)("div",{className:Pn.placeholder,children:[(0,e.jsx)("img",{src:le,width:40,style:{marginRight:8}}),(0,e.jsxs)(Le.Z,{direction:"vertical",size:16,style:{marginBottom:120},children:[(0,e.jsx)(Dn.Z,{title:S("home.title"),description:S("home.description")}),(0,e.jsx)(Fn.Z,{items:a,title:"\u{1F4A1}".concat(S("home.placeholderPromptsTitle"),"\uFF1A"),vertical:!0,onItemClick:g})]})]})},Bn=Mn,Ln=o(46271),ze=o(69215),On=o(75991),Je={"sender-header":"sender-header___Rb3RF","icon-file":"icon-file___VqG6V"},An=function(v){var a=v.open,g=v.attachedFiles,c=v.onOpenChange,S=v.handleFileChange,u=v.onAddUploadId,j=(0,Ln.p)(),T=j.runUploadFile,f=(0,ve.Z)(),i=f.formatMessage,O=function(){var U=Be()(xe()().mark(function R(P){var k,Y,z,E,Q,G;return xe()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(Y=P.type,z=P.size,E=P.name,Q=new Blob([P],{type:Y}),!(z>20971520)){M.next=5;break}return ze.yw.error(i("knowledgebase.detail.upload.errorSize")),M.abrupt("return",!1);case 5:return M.next=7,T({file:Q,filename:E});case 7:if(G=M.sent,G!=null&&G.success){M.next=11;break}return ze.yw.error(G==null?void 0:G.message),M.abrupt("return",On.Z.LIST_IGNORE);case 11:return u({file_id:(G==null||(k=G.data)===null||k===void 0?void 0:k.file_id)||"",uid:P.uid}),M.abrupt("return",!1);case 13:case"end":return M.stop()}},R)}));return function(P){return U.apply(this,arguments)}}();return(0,e.jsx)("div",{className:Je["sender-header"],children:(0,e.jsx)(Ae.Z.Header,{title:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("i",{className:"iconfont  icon-Chat2graphwenjianshangchuanbiaoshi ".concat(Je["icon-file"])}),i("home.attachment")]}),open:a,onOpenChange:c,styles:{content:{padding:0}},children:(0,e.jsx)(Oe.Z,{beforeUpload:O,name:"file",accept:".pdf,.xlsx,.doc,.docx,.md,.txt",items:g,onChange:S,placeholder:function(R){return R==="drop"?{title:"Drop file here"}:{icon:(0,e.jsx)("i",{className:"iconfont icon-Chat2graphtuofangwenjian",style:{fontSize:30,color:"#98989d"}}),title:i("knowledgebase.detail.upload.title"),description:i("knowledgebase.detail.upload.description")}}})})})},Un=An,H=o(79074),$=o(74753),zn=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return v.map(function(a){return{key:(a==null?void 0:a.id)||"",label:(a==null?void 0:a.name)||"",timestamp:(a==null?void 0:a.timestamp)||""}})},Jn=function(){var v=(0,je.x)({sessions:[]}),a=X()(v,2),g=a[0],c=a[1],S=function(){var ne=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];c(function(he){he.sessions=ne})},u=(0,H.useRequest)($.Z.getSessions,{manual:!0}),j=u.run,T=u.loading,f=(0,H.useRequest)($.Z.createSession,{manual:!0}),i=f.run,O=f.loading,U=(0,H.useRequest)($.Z.getSessionById,{manual:!0}),R=U.run,P=U.loading,k=(0,H.useRequest)($.Z.deleteSession,{manual:!0}),Y=k.run,z=k.loading,E=(0,H.useRequest)($.Z.updateSession,{manual:!0}),Q=E.run,G=E.loading,_=(0,H.useRequest)($.Z.getJobIdsBySessionId,{manual:!0}),M=_.run,ge=_.loading,C=(0,H.useRequest)($.Z.getJobIdById,{manual:!0}),re=C.run,F=C.loading,b=(0,H.useRequest)($.Z.getJobResults,{manual:!0}),Z=b.run,h=b.loading,N=b.cancel,B=(0,H.useRequest)($.Z.getMessagesBySessionId,{manual:!0}),W=B.run,q=(0,H.useRequest)($.Z.stopSession,{manual:!0}),ee=q.run,Ze=(0,H.useRequest)($.Z.recoverSession,{manual:!0}),Re=Ze.run,ke=function(ne){j({page:1,size:10}).then(function(he){var de=he||{},Ce=de.data;S(zn(Ce)),ne==null||ne(Ce)})};return{sessionEntity:g,getSessionList:ke,loadingGetSessions:T,runCreateSession:i,loadingCreateSession:O,runGetSessionById:R,loadingGetSessionById:P,runDeleteSession:Y,loadingDeleteSession:z,runUpdateSession:Q,loadingUpdateSession:G,runGetJobIdsBySessionId:M,loadingGetJobIdsBySessionId:ge,runGetJobById:re,loadingGetJobById:F,runGetJobResults:Z,loadingGetJobResults:h,runGetMessagesBySessionId:W,cancelGetJobResults:N,runStopSession:ee,runRecoverSession:Re}},Hn=o(12515),He=o(48054),$e=o(69234),$n=o(20901),be=o(96486),D={"bubble-content-header":"bubble-content-header___kIs4d","bubble-content-steps":"bubble-content-steps___PKy2Z","bubble-content-message":"bubble-content-message___k2Ouh","bubble-content-status":"bubble-content-status___rd1hd","bubble-content-status-text":"bubble-content-status-text___SBiMP","bubble-content":"bubble-content___bHHC7","bubble-content-footer":"bubble-content-footer___mWy5K","bubble-content-footer-recover":"bubble-content-footer-recover___CLBPI",title:"title___v3Ceu","title-content":"title-content___kh_fW","title-extra":"title-extra___TC12p","step-icon":"step-icon___MQ1x5","step-thinks-title":"step-thinks-title___MWpX8"},Kn=function(v){var a=Math.floor(v/1e3),g=Math.floor(a/3600),c=Math.floor(a%3600/60),S=a%60;return{hours:g,minutes:c,seconds:S}},Ke=o(25332),We=o(4958),Se={"think-collapse":"think-collapse___ylQ4h","think-collapse-message":"think-collapse-message___T5Uy1","step-thinks-title":"step-thinks-title___FJ5xY","step-thinks-title-expert":"step-thinks-title-expert___vnO3y"},Ye=o(48115),Qe=o(80882),me={created:"created___xu5hY",running:"running___LD5Yd",finished:"finished___rmimG",failed:"failed___tvZSN",stopped:"stopped___vQkxK"},Wn=function(v){var a=v.status,g=v.percent,c=g===void 0?0:g;switch(a){case y.C7.CREATED:return(0,e.jsx)(ie.Z,{percent:1,className:me.created});case y.C7.RUNNING:return(0,e.jsx)(ie.Z,{percent:c||75,className:me.running});case y.C7.FINISHED:return(0,e.jsx)(ie.Z,{percent:100,className:me.finished});case y.C7.FAILED:return(0,e.jsx)(ie.Z,{percent:75,className:me.failed});case y.C7.STOPPED:return(0,e.jsx)(ie.Z,{percent:75,className:me.stopped});default:return null}},Xe=Wn,Yn=function(v){var a=v.think,g=(0,ve.Z)(),c=g.formatMessage;return(0,e.jsx)("div",{className:Se["think-collapse"],children:(0,e.jsx)($e.Z,{collapsible:"header",defaultActiveKey:["1"],expandIconPosition:"end",expandIcon:function(u){var j=u.isActive;return j?(0,e.jsx)(Ye.Z,{style:{color:"#6a6b71"}}):(0,e.jsx)(Qe.Z,{style:{color:"#6a6b71"}})},items:[{key:"1",label:(0,e.jsxs)("p",{className:Se["step-thinks-title"],children:[(0,e.jsx)(Xe,{status:a==null?void 0:a.status}),(0,e.jsxs)("span",{className:Se["step-thinks-title-expert"],children:["@",a!=null&&a.assigned_expert_name?c("home.expert.".concat(y.oT[a.assigned_expert_name])):"\u5BFC\u6570\u4E13\u5BB6"]}),": ",a==null?void 0:a.goal]}),children:a!=null&&a.payload?(0,e.jsx)("div",{className:Se["step-thinks-message"],children:(0,e.jsx)(Ke.UG,{remarkPlugins:[We.Z],children:a==null?void 0:a.payload})},"".concat(a==null?void 0:a.jobId,"_payload")):(0,e.jsx)(He.Z,{paragraph:{rows:1},active:!0})}]})})},Qn=Yn,Xn=o(7427),Vn=o(20745),Ve={graph:"graph___k4MWE",graph_description:"graph_description___Nrp7R"},wn=function(v){var a=v.message,g=function(u){if(!u)return{};try{var j=JSON.parse(u),T=j.vertices,f=j.edges;return{nodes:T,edges:f==null?void 0:f.map(function(i){return A()(A()({},i),{},{id:"".concat(i==null?void 0:i.source,"_").concat(i==null?void 0:i.target,"_").concat(i==null?void 0:i.label)})})}}catch(i){console.error("formatGraphData"+i)}},c=function(u){try{var j=u[0].properties,T=document.createElement("div"),f=(0,Vn.createRoot)(T);return f.render((0,e.jsx)("div",{children:Object.entries(j).map(function(i){var O=X()(i,2),U=O[0],R=O[1];return(0,e.jsxs)("div",{children:[U,": ",R?JSON.stringify(R):"-"]},U)})})),T}catch(i){console.error("getTooltipContent"+i)}};return(0,w.useEffect)(function(){try{var S=new Xn.kJ({container:"graph_".concat(a==null?void 0:a.id),data:g(a==null?void 0:a.payload),height:400,animation:!1,autoResize:!0,autoFit:"view",node:{style:{labelText:function(j){return j==null?void 0:j.alias},labelFontSize:8}},edge:{style:{labelText:function(j){return j==null?void 0:j.alias},endArrow:!0,labelFontSize:8,labelBackgroundFill:"#fff",labelBackground:!0}},layout:{type:"force",linkDistance:300,clustering:!0,preventOverlap:!0,nodeClusterBy:"cluster",clusterNodeStrength:70,nodeSize:20},behaviors:["zoom-canvas","drag-canvas","click-select"],transforms:["process-parallel-edges"],plugins:[{type:"tooltip",key:"tooltip",trigger:"click",enterable:!0,getContent:function(j,T){return c(T)}}]});S.render()}catch(u){console.error("GraphMessage:"+u)}},[]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{id:"graph_".concat(a==null?void 0:a.id),className:Ve.graph}),(0,e.jsx)("div",{className:Ve.graph_description,children:a==null?void 0:a.graph_description})]})},_n=wn,qn=function(v){var a,g,c=v.status,S=v.content,u=v.message,j=v.isLast,T=v.onRecoverSession,f=(0,ve.Z)(),i=f.formatMessage,O=(0,w.useState)([]),U=X()(O,2),R=U[0],P=U[1],k=(0,je.x)({thinks:[],startTime:new Date().getTime(),diffTime:0,percent:20}),Y=X()(k,2),z=Y[0],E=Y[1],Q=z.startTime,G=z.diffTime,_=z.percent,M=function(b,Z){var h=new Map(b.map(function(N){return[N.jobId,N]}));return Z.forEach(function(N){var B=h.get(N.jobId);if(B){var W,q,ee;B.goal=(W=N.goal)!==null&&W!==void 0?W:B.goal,B.payload=(q=N.payload)!==null&&q!==void 0?q:B.payload,B.status=(ee=N.status)!==null&&ee!==void 0?ee:B.status}else h.set(N.jobId,A()({},N))}),Array.from(h.values())},ge=(0,be.throttle)(function(){var F,b=0,Z=u==null||(F=u.thinking)===null||F===void 0?void 0:F.map(function(h){var N,B,W;return(h==null?void 0:h.status)===y.C7.FINISHED&&(b+=1),{jobId:h==null||(N=h.job)===null||N===void 0?void 0:N.id,status:h==null?void 0:h.status,goal:h==null||(B=h.job)===null||B===void 0?void 0:B.goal,payload:(h==null?void 0:h.status)===y.C7.FINISHED?h==null?void 0:h.payload:"",assigned_expert_name:h==null||(W=h.job)===null||W===void 0?void 0:W.assigned_expert_name}});P(M(R,Z)),E(function(h){var N;(c===y.C7.CREATED||c===y.C7.RUNNING)&&(h.diffTime=new Date().getTime()-Q),h.percent=20+60*(b/(u==null||(N=u.thinking)===null||N===void 0?void 0:N.length))})},2e3);(0,w.useEffect)(function(){ge()},[u]);var C=function(){if(!G)return null;var b=Kn(G),Z=b.minutes,h=b.seconds;return"".concat(Z?Z+i("home.thinks.minutes"):"").concat(h+i("home.thinks.seconds"))},re=(0,w.useMemo)(function(){var F=[{title:(0,e.jsx)("div",{className:D.title,children:(0,e.jsx)("div",{className:D["title-content"],children:i("home.thinks.planning")})}),description:(0,e.jsx)("div",{children:i("home.thinks.planningDesc")}),icon:(0,e.jsx)("img",{src:le,className:D["step-icon"]})},{title:(0,e.jsxs)("div",{className:D.title,children:[(0,e.jsx)("div",{className:D["title-content"],children:i("home.thinks.analyze")}),(0,e.jsx)("div",{className:D["title-extra"],children:C()})]}),description:(0,e.jsxs)("div",{className:D["step-thinks"],children:[R.map(function(b){return(0,e.jsx)(Qn,{think:b},"".concat(b==null?void 0:b.jobId,"_goal"))}),c!==y.C7.FINISHED&&(R==null?void 0:R.length)===0&&(0,e.jsx)(He.Z,{paragraph:{rows:2},active:!0})]}),icon:(0,e.jsx)("img",{src:le,className:D["step-icon"]})}];return c===y.C7.FINISHED&&(E(function(b){b.percent=100}),F.push({title:(0,e.jsx)("div",{className:D.title,children:(0,e.jsx)("div",{className:D["title-content"],children:i("home.thinks.answer")})}),icon:(0,e.jsx)("img",{src:le,className:D["step-icon"]}),description:(0,e.jsx)(e.Fragment,{})})),F},[u,R,c]);return(0,e.jsxs)("div",{className:D["bubble-content"],children:[(0,e.jsx)($e.Z,{collapsible:"header",defaultActiveKey:["1"],expandIconPosition:"end",expandIcon:function(b){var Z=b.isActive;return R!=null&&R.length?Z?(0,e.jsx)(Ye.Z,{style:{color:"#6a6b71"}}):(0,e.jsx)(Qe.Z,{style:{color:"#6a6b71"}}):null},items:[{key:"1",label:(0,e.jsx)("div",{className:D["bubble-content-header"],children:(0,e.jsxs)("div",{className:D["bubble-content-status"],children:[(0,e.jsx)(Xe,{status:c,percent:_}),(0,e.jsx)("span",{className:D["bubble-content-status-text"],children:i(y.nf[c])})]})}),children:(0,e.jsx)($n.Z,{items:re,direction:"vertical"})}]}),S&&(c===y.C7.FINISHED||c===y.C7.FAILED)&&(0,e.jsxs)("div",{className:D["bubble-content-message"],children:[(0,e.jsx)(Ke.UG,{remarkPlugins:[We.Z],children:S}),u!=null&&u.isTyping&&u!==null&&u!==void 0&&(a=u.attached_messages)!==null&&a!==void 0&&a.length?(0,e.jsx)("div",{children:u==null||(g=u.attached_messages)===null||g===void 0?void 0:g.map(function(F){return(0,e.jsx)(_n,{message:F},F==null?void 0:F.id)})}):null]}),j&&c===y.C7.STOPPED?(0,e.jsx)("div",{className:D["bubble-content-footer"],children:(0,e.jsxs)("div",{className:D["bubble-content-footer-recover"],onClick:T,children:[(0,e.jsx)("i",{className:"iconfont icon-Chat2graphjixusikao",style:{fontSize:24}}),(0,e.jsx)("span",{children:i("home.recover")})]})}):null]})},es=qn,ns=o(66600),ss=function(v,a){if(!a)return"";var g=new Date(a*1e3),c=new Date,S=new Date(c);S.setDate(c.getDate()-1);var u=function(i){return i<10?"0"+i:i};if(g.toDateString()===c.toDateString())return v("home.today");if(g.toDateString()===S.toDateString())return v("home.yesterday");var j=u(g.getMonth()+1),T=u(g.getDate());return v("home.date",{month:j,day:T})},we=o(99331),ts=o(13939),as=function(){var v,a,g=(0,ns._)(),c=g.getLocalStorage,S=g.setLocalStorage,u=g.removeLocalStorage,j=(0,je.x)({conversationsItems:[],headerOpen:!1,activeKey:"",collapse:!1,placeholderPromptsItems:y.dV,content:"",attachedFiles:[],isInit:!1,uplodaFileIds:[],closeTag:!1,editing:!1}),T=X()(j,2),f=T[0],i=T[1],O=f.editing,U=f.isInit,R=f.conversationsItems,P=f.activeKey,k=f.collapse,Y=f.placeholderPromptsItems,z=f.content,E=f.attachedFiles,Q=f.headerOpen,G=f.uplodaFileIds,_=f.closeTag,M=f.selectedFramework,ge=(0,ve.Z)(),C=ge.formatMessage,re=(0,ts.z)(),F=re.getDatabaseList,b=re.databaseEntity,Z=Jn(),h=Z.sessionEntity,N=Z.getSessionList,B=Z.loadingGetSessions,W=Z.runCreateSession,q=Z.runUpdateSession,ee=Z.runDeleteSession,Ze=Z.runGetSessionById,Re=Z.runGetJobResults,ke=Z.runGetJobIdsBySessionId,Te=Z.runGetMessagesBySessionId,ne=Z.runStopSession,he=Z.runRecoverSession,de=h.sessions,Ce=function(s,t){q({session_id:t},{name:s}).then(function(l){var n=l.success;n&&N()})},_e=null,Ee=function(s){if(!s)return null;var t=s||{},l=t.message,n=l.instruction_message,r=l.attached_messages,d=t.thinking,p=t.metrics,x=d==null?void 0:d.map(function(L){var J=L.message,ae=L.metrics,Ne=L.job;return{payload:J==null?void 0:J.payload,message_type:J==null?void 0:J.message_type,status:ae==null?void 0:ae.status,job:Ne}});return{payload:n==null?void 0:n.payload,session_id:n==null?void 0:n.session_id,job_id:n==null?void 0:n.job_id,role:n==null?void 0:n.role,attached_messages:r,thinking:x,status:p==null?void 0:p.status}},is=function(){ne({session_id:P})},Ge=(0,w.useCallback)(function(m,s,t){_e=setTimeout(function(){Re({job_id:m}).then(function(l){var n,r,d=(l==null||(n=l.data)===null||n===void 0||(n=n.answer)===null||n===void 0?void 0:n.metrics)||{},p=d.status;if(c(y.U4)==="true"){s({}),u(y.U4);return}if(["RUNNING","CREATED"].includes(p)){var x;t(Ee(l==null||(x=l.data)===null||x===void 0?void 0:x.answer)),Ge(m,s,t);return}clearTimeout(_e),s(Ee(l==null||(r=l.data)===null||r===void 0?void 0:r.answer))})},2e3)},[_]),qe=function(){var s=E==null?void 0:E.map(function(l){return l==null?void 0:l.uid}),t=[];return G==null||G.forEach(function(l){if(s.includes(l==null?void 0:l.uid)){var n=E==null?void 0:E.find(function(p){return(p==null?void 0:p.uid)===l.uid}),r=n.name,d=n.size;t.push({file_id:l==null?void 0:l.file_id,message_type:"FILE",name:r,size:d})}}),t},ls=(0,Cn.Z)({request:function(){var m=Be()(xe()().mark(function t(l,n){var r,d,p,x,L,J,ae,Ne,sn,tn;return xe()().wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:if(r=l.message,d=n.onSuccess,p=n.onUpdate,x=r||{},L=x.payload,J=L===void 0?"":L,ae=x.session_id,Ne=ae===void 0?"":ae,sn=x.attached_messages,tn=x.isRunning,!tn){pe.next=6;break}return Ge(J,d,p),pe.abrupt("return");case 6:ke({session_id:Ne},{instruction_message:{payload:J,message_type:"TEXT",assigned_expert_name:M||null},attached_messages:sn}).then(function(ce){var xs=(ce==null?void 0:ce.data)||{},an=xs.job_id,ys=an===void 0?"":an;Ge(ys,d,p),p((ce==null?void 0:ce.data)||{}),i(function(Pe){Pe.uplodaFileIds=[],Pe.attachedFiles=[],Pe.headerOpen=!1})});case 7:case"end":return pe.stop()}},t)}));function s(t,l){return m.apply(this,arguments)}return s}()}),rs=X()(ls,1),ue=rs[0],De=(0,In.Z)({agent:ue,parser:function(s){return s}}),Ie=De.onRequest,se=De.parsedMessages,fe=De.setMessages,Fe=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";i(function(t){t.content=s})},ds=function(s){var t,l,n=s||{},r=n.answer,d=n.question,p=[{id:d==null||(t=d.message)===null||t===void 0?void 0:t.id,message:d==null?void 0:d.message,status:"success"},{id:r==null||(l=r.message)===null||l===void 0?void 0:l.id,message:Ee(r),status:"success"}];return p},en=function(s){ue.isRequesting()&&S(y.U4,!0),i(function(t){t.selectedFramework=void 0}),Ze({session_id:s}).then(function(t){t.success&&i(function(l){l.activeKey=s,l.uplodaFileIds=[],l.attachedFiles=[],l.headerOpen=!1})}),Te({session_id:s}).then(function(t){var l,n,r;t!=null&&(l=t.data)!==null&&l!==void 0&&l.length&&i(function(x){x.isInit=!0});var d=(t==null||(n=t.data)===null||n===void 0||(n=n.map(function(x){return ds(x)}))===null||n===void 0?void 0:n.flat())||[];if(d!=null&&d.length&&[y.C7.RUNNING,y.C7.CREATED].includes((r=d[(d==null?void 0:d.length)-1])===null||r===void 0||(r=r.message)===null||r===void 0?void 0:r.status)){var p;Ie({payload:(p=d[(d==null?void 0:d.length)-1])===null||p===void 0||(p=p.message)===null||p===void 0?void 0:p.job_id,isRunning:!0}),d.pop()}fe(d)}),u(y.Q8)},us=function(){var s;he({session_id:P});var t=(0,be.cloneDeep)(se),l=t==null?void 0:t.pop();Ie({payload:l==null||(s=l.message)===null||s===void 0?void 0:s.job_id,isRunning:!0}),fe(t)},te=se==null?void 0:se.filter(function(m){return!(0,be.isEmpty)(m==null?void 0:m.message)}).map(function(m,s,t){var l,n=m.message,r=m.id;return{key:r,loading:(n==null?void 0:n.role)==="SYSTEM"&&!(n!=null&&n.thinking),role:(n==null?void 0:n.role)==="SYSTEM"?"ai":"local",content:(n==null?void 0:n.payload)||(n==null||(l=n.instruction_message)===null||l===void 0?void 0:l.payload)||C("home.noResult"),avatar:(n==null?void 0:n.role)==="SYSTEM"?{icon:(0,e.jsx)("img",{src:le})}:void 0,typing:(n==null?void 0:n.role)==="SYSTEM"&&!U?{step:3,interval:50}:!1,messageRender:function(p){var x;return(n==null?void 0:n.role)==="SYSTEM"?(0,e.jsx)(es,{onRecoverSession:us,isLast:s===t.length-1,status:n==null?void 0:n.status,message:n,content:p},r):(0,e.jsxs)("div",{className:I["user-conversation"],children:[(0,e.jsx)("pre",{className:I["user-conversation-question"],children:p}),(0,e.jsx)(ye.Z,{vertical:!0,gap:"middle",children:n==null||(x=n.attached_messages)===null||x===void 0?void 0:x.map(function(L){var J={name:L.name,size:+(L==null?void 0:L.size)};return(0,e.jsx)(Oe.Z.FileCard,{item:J},L.uid)})})]})},onTypingComplete:function(){var p=se==null?void 0:se.filter(function(x){return!(0,be.isEmpty)(x==null?void 0:x.message)}).map(function(x,L){return L===s?A()(A()({},x),{},{message:A()(A()({},x.message),{},{isTyping:!0})}):x});fe(p)}}}),cs=function(){fe([]),i(function(s){s.selectedFramework=void 0}),ue.isRequesting()&&S(y.U4,!0)},vs=function(s){var t=dn()(y.aS),l;try{for(t.s();!(l=t.n()).done;){var n=l.value;if(s.startsWith(n))return s.slice(n.length).trim()}}catch(r){t.e(r)}finally{t.f()}return s.trim()},ms=function(s){return{trigger:function(){return(0,e.jsx)("div",{id:"conversation-extra",children:(0,e.jsxs)(Le.Z,{children:[(0,e.jsx)(V.Z,{title:C("home.rename"),placement:"left",children:(0,e.jsx)("div",{className:I["conversation-extra-icon"],onClick:function(n){n.stopPropagation(),!O&&(i(function(r){r.editing=!0}),i(function(r){r.conversationsItems=(r.conversationsItems||[]).map(function(d){return d.key!==s.key?d:A()(A()({},d),{},{label:(0,e.jsx)(Gn,{name:vs(d.label),onEdited:function(){i(function(x){x.editing=!1})},onConfirm:function(x){Ce(x,s.key)}})})})}))},children:(0,e.jsx)(pn.Z,{})})}),(0,e.jsx)(gn.Z,{title:C("home.deleteConversation"),okText:C("home.confirm"),cancelText:C("home.cancel"),onConfirm:function(n){n.stopPropagation(),ee({session_id:s.key}).then(function(r){r!=null&&r.success&&(N(),hn.ZP.success(C("home.deleteConversationSuccess")),P===s.key&&(ue.isRequesting()&&S(y.U4,!0),i(function(d){d.activeKey=""}),fe([])))})},children:(0,e.jsx)(V.Z,{title:C("home.delete"),placement:"right",children:(0,e.jsx)("div",{className:I["conversation-extra-icon"],onClick:function(n){n.stopPropagation()},children:(0,e.jsx)(xn.Z,{})})})})]})})},items:[]}},nn=function(s){if(!(!s||ue.isRequesting()||E!=null&&E.some(function(t){return(t==null?void 0:t.status)==="uploading"}))){if(i(function(t){t.isInit=!1}),!te.length){W({name:s}).then(function(t){if(t.success){var l;N(),i(function(n){var r;n.activeKey=(t==null||(r=t.data)===null||r===void 0?void 0:r.id)||""}),Ie({payload:s,session_id:t==null||(l=t.data)===null||l===void 0?void 0:l.id,attached_messages:qe()}),Fe("")}});return}Ie({payload:s,session_id:f.activeKey,attached_messages:qe()}),Fe("")}},gs=function(s){nn(s.data.label)},hs=function(s){i(function(t){t.attachedFiles=s.fileList})};(0,w.useEffect)(function(){i(function(m){m.editing=!1,m.conversationsItems=de==null?void 0:de.map(function(s){return A()(A()({},s),{},{label:"".concat((s==null?void 0:s.key)===P?C("home.current"):"").concat(s==null?void 0:s.label),group:ss(C,s==null?void 0:s.timestamp)})})})},[de,P]),(0,w.useEffect)(function(){N(),F();var m=c(y.Q8);m&&en(m)},[]);var fs=function(s){i(function(t){t.uplodaFileIds=[].concat(ln()(t.uplodaFileIds),[s])})},ps=function(s){return s.map(function(t){return A()(A()({},t),{},{label:C(t.labelId)})})};return(0,e.jsxs)("div",{className:I.wrapper,children:[(0,e.jsx)(Hn.Z,{}),(0,e.jsxs)("div",{className:"".concat(I.sider," ").concat(k?I["sider-collapsed"]:""),children:[(0,e.jsxs)("div",{className:I.title,children:[(0,e.jsxs)("span",{className:I["title-text"],children:[(0,e.jsx)("img",{src:le,className:I["title-logo"]}),!k&&(0,e.jsx)("span",{children:"Chat2Graph"})]}),(0,e.jsx)("div",{className:I["sider-collapsed-icon"],onClick:function(){i(function(s){s.collapse=!s.collapse})},children:k?(0,e.jsx)(yn.Z,{}):(0,e.jsx)(jn.Z,{})})]}),(0,e.jsx)(V.Z,{title:k?C("home.openNewConversation"):"",children:(0,e.jsx)(oe.ZP,{onClick:cs,type:k?"text":"primary",className:I["create-conversation"],icon:(0,e.jsx)(bn.Z,{style:{fontSize:"13px",color:"#1677ff"}}),size:"large",block:!0,ghost:!!k,children:k?"":C("home.openNewConversation")})}),(0,e.jsx)(ie.Z,{spinning:B,children:(0,e.jsx)(Nn.Z,{items:R,className:I.conversations,activeKey:P,onActiveChange:en,menu:ms,groupable:!0})}),(0,e.jsx)("p",{className:I.tips,children:C("home.tips")}),(0,e.jsx)(V.Z,{title:k?C("home.manager"):"",children:(0,e.jsx)(oe.ZP,{onClick:function(){window.open((0,we.i)("/manager/knowledgebase"),"_blank")},type:"text",className:"".concat(I["go-manager"]," ").concat(k?I["go-manager-collapsed"]:""),style:k?{bottom:52}:{},icon:(0,e.jsx)(Sn.Z,{}),size:"large",block:!0,ghost:!!k,children:k?"":C("home.manager")})})]}),(0,e.jsxs)("div",{className:[I.chat,te!=null&&te.length?"":I["chat-emty"]].join(" "),children:[b!=null&&(v=b.databaseList)!==null&&v!==void 0&&v.length?null:(0,e.jsx)(fn.Z,{message:(0,e.jsxs)("div",{children:[C("home.tip"),(0,e.jsx)("a",{href:(0,we.i)("/manager/graphdb"),target:"_blank",rel:"noreferrer",children:C("home.click")})]}),type:"error"}),(0,e.jsx)(Zn.Z.List,{items:te.length>0?te:[{content:(0,e.jsx)(Bn,{placeholderPromptsItems:ps(Y),onPromptsItemClick:gs}),variant:"borderless"}],roles:y.K$,className:"".concat(I.messages," ").concat(te.length?"":I.welcome," ").concat(b!=null&&(a=b.databaseList)!==null&&a!==void 0&&a.length?"":I["has-tip"])}),(0,e.jsx)("footer",{className:I.footer,children:(0,e.jsx)(Ae.Z,{value:z,header:(0,e.jsx)(Un,{open:Q,onAddUploadId:fs,attachedFiles:E,handleFileChange:hs,onOpenChange:function(s){i(function(t){t.headerOpen=s})}}),onSubmit:nn,onChange:Fe,actions:!1,placeholder:C("home.placeholder"),className:I.sender,footer:function(s){var t=s.components,l=t.SendButton,n=t.LoadingButton;return(0,e.jsxs)(ye.Z,{justify:"space-between",align:"start",children:[(0,e.jsx)(ye.Z,{gap:"small",align:"center",className:I.framework,children:y.JR.map(function(r){return(0,e.jsxs)(oe.ZP,{type:f.selectedFramework===r.key?"primary":"default",onClick:function(){i(function(p){p.selectedFramework=p.selectedFramework===r.key?void 0:r.key})},children:[(0,e.jsx)("i",{className:"iconfont  ".concat(r.icon),style:{fontSize:"20px"}}),C("home.expert.".concat(r.textId))]},r.key)})}),(0,e.jsxs)(ye.Z,{align:"center",gap:12,children:[(0,e.jsx)(V.Z,{title:C("knowledgebase.detail.upload.description"),children:(0,e.jsx)(oe.ZP,{type:"text",icon:(0,e.jsx)("i",{className:"iconfont  icon-Chat2graphshangchuan",style:{fontSize:30,color:"#6a6b71"}}),onClick:function(){i(function(d){d.headerOpen=!d.headerOpen})}})}),ue.isRequesting()?(0,e.jsx)(V.Z,{title:"\u70B9\u51FB\u505C\u6B62\u751F\u6210",children:(0,e.jsx)("div",{onClick:is,children:(0,e.jsx)(n,{type:"default"})})}):(0,e.jsx)(V.Z,{title:C("home.".concat(z?"send":"placeholder")),children:(0,e.jsx)(l,{type:"primary",disabled:!z})})]})]})}})})]})]})},os=as}}]);
